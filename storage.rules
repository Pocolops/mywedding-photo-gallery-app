rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Photos storage rules
    match /photos/{allPaths=**} {
      // Allow anyone to read photos (public wedding gallery)
      allow read: if true;
      
      // Allow anyone to upload photos with restrictions
      allow write: if request.auth == null
        && isValidImageFile(resource, request.resource)
        && request.resource.size < 50 * 1024 * 1024; // 50MB limit
    }
    
    // Helper function to validate image files
    function isValidImageFile(existingResource, newResource) {
      return newResource.contentType.matches('image/.*')
        && newResource.contentType in ['image/jpeg', 'image/png', 'image/gif', 'image/webp']
        && (existingResource == null || existingResource.contentType == newResource.contentType);
    }
  }
} 